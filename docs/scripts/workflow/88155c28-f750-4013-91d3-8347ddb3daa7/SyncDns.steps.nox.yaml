steps:
  - name: Connect to AAD
    id: connect
    uses: azuread/connect_v1
    with:
      tenant-id: ${{ server.secrets.AZURE_TENANT_ID }}
      client-id: ${{ server.secrets.AZURE_CLIENT_ID }}
      client-secret: ${{ server.secrets.AZURE_CLIENT_SECRET }}
    display:
      success: Connected to Azure AD
      error: Failed to connect to Azure AD ${{ steps.connect.error-message }}
    run-at-server: true

  - name: Find CName
    id: find-cname
    uses: azuread/find-cname-record@v1
    with:
      aad-client: ${{ steps.connect.outputs.aad-client }}
      resource-group-name: rg_dns_common_prod
      zone-name: ingena.work
    display:
      success: Searched for CName record
      error: Unable to search for CName record (${{ steps.find-cname.error-message }})
    run-at-server: true