steps:
  - name: Add the remote repo to local git
    id: git-add-remote
    uses: powershell/script@v1
    with:
      script: git remote add iwgplc ${{ project.versionControl.server }}/${{ project.versionControl.project }}/_git/${{ project.versionControl.repository }}
    display:
      success: Added the remote repo to local git
      error: Unable to add the remote repo to local git (${{ steps.git-add-remote.error-message }})

  - name: Get a AzDevOps PAT
    id: get-devops-pat
    uses: azdevops/get-pat@v1
    with:
      organization: iwgplc
      access-token: ${{ cache.aztoken }}

  - name: Pull the remote repo
    id: git-pull-remote
    uses: powershell/script@v1
    with:
      script: "git -c http.extraHeader=\"Authorization: Basic ${{ steps.get-devops-pat.outputs.base64-result }}\" pull --rebase iwgplc main"
    display:
      success: Pulled the remote repository
      error: Unable to pull the remote repository (${{ steps.git-pull-remote.error-message }})

  - name: Push local repo to remote
    id: git-push-local
    uses: powershell/script@v1
    with:
      script: "git -c http.extraHeader=\"Authorization: Basic ${{ steps.get-devops-pat.outputs.base64-result }}\" push --set-upstream iwgplc main"
    display:
      success: Pushed the local changes to remote
      error: Unable to push the local changes to remote (${{ steps.git-push-local.error-message }})