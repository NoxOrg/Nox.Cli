# NOX Test Add Terraform values

name: Test add tf values

cli:
  branch: test
  command: add-tf-values
  command-alias: atfvs
  description: Test add tf values
  examples:
    - ["sync add-tf-values", "--path <designFolder>"]
    - ["sync atfvs", "--path <designFolder>"]

jobs:
  sync-test:  
    steps:

      - name: get tf project name
        id: get-proj-name
        uses: core/to-snake-case@v1
        with:
          source-string: ${{ project.versionControl.project }}
        display:
          success: Got the project name -> ${{ steps.get-proj-name.outputs.result }}
          error: Unable to get the project name

      - name: Read HCL file
        id: load-file
        uses: file/read-text@v1
        with:
          path: /home/jan/Temp/tfe_variable_set.tf
        display:
          success: Loaded the file
          error: Unable to load the file ${{ steps.load-file.error-message }}

      - name: Add some value
        id: add-values
        uses: hcl/add-values@v1
        with:
          source-hcl: ${{ steps.load-file.outputs.result-string }}
          values-to-add:
            - variable_set_params/azure_tenant/workspace_ids->module.heimdall_nox_sample_workspaces.workspaces[\"${{ steps.get-proj-name.outputs.result }}_prod_ne\"].id
            - variable_set_params/azure_tenant/workspace_ids->module.heimdall_nox_sample_workspaces.workspaces[\"${{ steps.get-proj-name.outputs.result }}_test_ne\"].id
        display:
          success: Added the values
          error: There was a problem adding the values (${{ steps.add-values.error-message }})

      - name: Save the file
        id: save-file
        uses: file/write-text@v1
        with:
          path: /home/jan/Temp/tfe_variable_set.updated.tf
          text-to-write: ${{ steps.add-values.outputs.result-hcl }}
        display:
          success: Saved the file
          error: Coult not save the file ${{ steps.save-file.error-message }}